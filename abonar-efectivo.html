<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Pokemon Bank - Depositar Efectivo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="assets/css/main.css" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/98424cc025.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!--Footer Styles-->
  <link rel="stylesheet" href="../demoChartjs-pagoServicios-footer/estilos.css" />

  <style>
    body { background-image: url("assets/img/bg.png"); }
    .app-shell { max-width: 1000px; min-height: 100vh; background: #fff; margin: 0 auto; }
    .section-border { border-top: 4px solid var(--bs-danger); }
  </style>
</head>
<body class="bg-light">
      <script>
      function requireLogin() {
    const usuario = JSON.parse(localStorage.getItem('usuario') || '{}');

    // If no user OR no login flag OR login is false
    if (!usuario || usuario.login !== true) {
        window.location.href = 'index.html';
        throw new Error('Not logged in');
    }
}
requireLogin();
    </script>
    <div class="app-shell">
        <header class="bg-danger text-white p-3 d-flex align-items-center justify-content-between sticky-top shadow">
            <a href="../panel.html" class="fw-bold fs-5 m-0 text-white text-decoration-none d-flex align-items-center">
                <img src="assets/img/pokeball.png" alt="Pokeball" style="height:32px; margin-left:10px; margin-right: 8px;">
               ThePokeBank
            </a>
            <button id="btnSalir" class="btn btn-sm btn-outline-light">
                <i class="fa-duotone fa-solid fa-right-from-bracket me-1"></i> Salir
            </button>
        </header>
        <main class="p-3">
            <div class="section-border mb-4">
                <div class="p-3 bg-body-tertiary">
                    <div class="d-flex align-items-start justify-content-between">
                        <i class="fa-duotone fa-solid fa-piggy-bank fs-3 me-3"></i>
                        <div class="flex-grow-1 ps-2 pt-0">
                            <span class="fw-semibold me-2" id="cuenta"></span>
                            <span>Cuenta de ahorros</span>
                            <div class="py-3 fw-semibold fs-3" id="saldo"></div>
                            <span class="text-secondary small">Saldo disponible</span>
                        </div>
                    </div>
                </div>
            </div>
            <h2 class="fw-medium text-dark fs-6 p-3 mb-2">
                <i class="fa-duotone fa-solid fa-money-bill-wave me-2"></i>Depósito de efectivo
            </h2>
            <!-- Se elimina 'required' para usar validación personalizada con SweetAlert -->
            <form id="retiroForm" class="mb-4" novalidate>
                <div class="mb-3">
                    <label for="montoDeposito" class="form-label">Monto a depositar</label>
                    <input type="number" step="0.01" class="form-control" id="montoDeposito">
                </div>
                <button type="submit" class="btn btn-danger w-100">Depositar</button>
            </form>
            <div id="mensajeRetiro"></div>
        </main>

<footer class="custom-footer mt-5">
  <div class="container">
    <div class="row">
      <div class="col-md-4 mb-4 mb-md-0">
        <h4 class="fw-bold mb-3">The Pokemon Bank</h4>
        <p class="somos mb-0">
          TPB es una institución financiera a tu servicio, ofreciendo las
          mejores soluciones bancarias para entrenadores Pokémon.
        </p>
        <div class="mt-0 mb-0">
          <img src="../assets/img/logo_pdf.png" alt="The Pokemon Bank" class="img-fluid" style="max-height: 100px;">
        </div>
      </div>

      <div class="col-md-4 mb-4 mb-md-0">
        <h4 class="fw-bold mb-3">Enlaces útiles</h4>
        <ul>
          <li><a href="#" class="link">Contacto y Sugerencias</a></li>
          <li><a href="#" class="link">Política de privacidad</a></li>
          <li><a href="#" class="link">FAQ</a></li>
          <li><a href="#" class="link">Términos y condiciones</a></li>
          <li><a href="#" class="link">Tasas & Comisiones</a></li>
        </ul>
      </div>

      <div class="col-md-4">
        <h4 class="fw-bold mb-3">Síguenos</h4>
        <div class="social-icons d-flex gap-3">
          <a class="link" href="https://x.com/" target="_blank" rel="noopener noreferrer">
            <i class="fa-brands fa-x-twitter fa-lg"></i>
          </a>
          <a class="link" href="https://www.facebook.com/" target="_blank" rel="noopener noreferrer">
            <i class="fab fa-facebook fa-lg"></i>
          </a>
          <a class="link" href="https://www.youtube.com/" target="_blank" rel="noopener noreferrer">
            <i class="fab fa-youtube fa-lg"></i>
          </a>
          <a class="link" href="https://instagram.com" target="_blank" rel="noopener noreferrer">
            <i class="fab fa-instagram fa-lg"></i>
          </a>
        </div>
      </div>

    </div>
  </div>
  <div class="footer-bottom text-center mt-4">
    <div class="container">
      <p class="mb-0">Todos los derechos reservados. TPB / EquipoDAW 2025 &copy;</p>
    </div>
  </div>
</footer>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="assets/js/pdf.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const datosCliente = JSON.parse(localStorage.getItem("usuario"));
            const cuentaEl = document.getElementById("cuenta");
            const saldoEl = document.getElementById("saldo");

            if (!datosCliente || !datosCliente.login) {
                location.href = "index.html";
                return;
            }

            cuentaEl.textContent = datosCliente.cuenta;
            saldoEl.textContent = "$" + datosCliente.saldo.toFixed(2);

            document.getElementById("btnSalir").addEventListener("click", () => {
                datosCliente.login = false;
                localStorage.setItem("usuario", JSON.stringify(datosCliente));
                location.href = "/";
            });

            document.getElementById("retiroForm").addEventListener("submit", function(e) {
                e.preventDefault();
                const monto = parseFloat(document.getElementById("montoDeposito").value);

                //Validación 1: Campo vacío o no numérico
                if (isNaN(monto) || document.getElementById("montoDeposito").value.trim() === "") {
                    Swal.fire({
                        icon: "warning",
                        title: "Monto inválido",
                        text: "Por favor, ingrese un monto válido."
                    });
                    return;
                }

                //Validación 2: Monto menor o igual a 0
                if (monto <= 0) {
                    Swal.fire({
                        icon: "error",
                        title: "Monto incorrecto",
                        text: "El monto debe ser mayor que 0."
                    });
                    return;
                }

                //Si todo está bien, actualiza el saldo
                datosCliente.saldo += monto;
                localStorage.setItem("usuario", JSON.stringify(datosCliente));
                saldoEl.textContent = "$" + datosCliente.saldo.toFixed(2);

                //Alerta de éxito
                Swal.fire({
                  icon: "success",
                  title: "Depósito realizado",
                  html: `
                    <p>Has depositado <strong>$${monto.toFixed(2)}</strong> con éxito.</p>
                    <button id="btnDescargarDepositoPDF" class="btn btn-danger mt-3">
                      Descargar en PDF
                    </button>
                  `,
                  showConfirmButton: false,
                  didOpen: () => {
                    document.getElementById("btnDescargarDepositoPDF").addEventListener("click", () => {
                      generarPDFTransaccion(datosCliente, monto, "dep");
                    });
                  }
                });

                //Limpia el formulario
                document.getElementById("retiroForm").reset();
            });
        });
    </script>
</body>
</html>
